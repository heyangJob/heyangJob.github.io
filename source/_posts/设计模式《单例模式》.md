---
title: 设计模式《单例模式》
date: 2019-03-31 20:36:06
tags:
categories: 设计模式
---

#### 引言
&emsp;&emsp;"送人玫瑰，手有余香"。最近在看设计模式，写点笔记记录一下，第一可以巩固一下所看的知道，第二方便他人阅读参考。从最简单的入手吧，今天的主角单例模式。
#### 示例地址
&emsp;&emsp;[Demo](https://github.com/heyangJob/Design-Pattern/tree/master/Singleton)
####  先看看单例模式的类图
![image](https://note.youdao.com/yws/api/personal/file/WEB9db71e90d14c30a564186910e7578892?method=download&shareKey=c6815c7f4eb20f73ae15074967e97c81)
####  再看看单例模式的定义
&emsp;&emsp;确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例。
#### 使用场景
&emsp;&emsp;确保某个类有且只有一个对象的场景，避免产生多个对象消耗过多的资源。
####  单例模式主要表现
    1. 构造方法私有
    2. 通过一个静态方法返回改对象
#### 单例模式示例
###### 1.  饿汉式
      
```
/**
 * 单例 饿汉式
 *
 * @author 512573717@qq.com
 * @created 2018/7/2 下午1:59.
 */
public class Singleton {

    private static Singleton mInstance = new Singleton();

    private Singleton() {
    }

    public static Singleton getInstance() {
        return mInstance;
    }
}
```
###### 2. 懒汉式

```
/**
 * 单例  懒汉式
 *
 * @author 512573717@qq.com
 * @created 2018/7/2 下午1:59.
 */
public class Singleton {
    //synchronized虽然保证了原子性，但却没有保证指令重排序的正确性，会出现A线程执行初始化，
    // 但可能因为构造函数里面的操作太多了，所以A线程的uniqueInstance实例还没有造出来，但已经被赋值了。
    // 而B线程这时过来了，错以为uniqueInstance已经被实例化出来，一用才发现uniqueInstance尚未被初始化。
    // 要知道我们的线程虽然可以保证原子性，但程序可能是在多核CPU上执行。
    // volatile  http://www.cnblogs.com/dolphin0520/p/3920373.html
    private static volatile Singleton mInstance = null;

    private Singleton() {
    }

    public static Singleton getInstance() {
        if (null == mInstance) {
            // 防止 多线程并发 创建多个实例
            synchronized (Singleton.class) {
                if (null == mInstance) {
                    mInstance = new Singleton();
                }
            }
        }
        return mInstance;
    }
}
```
###### 3. 静态内部类

```
/**
 * 单例 静态内部类
 *
 * @author 512573717@qq.com
 * @created 2018/7/2 下午1:59.
 */
public class Singleton {

    private Singleton() {
    }

    public static  class  SingletonHolder{
        private  static volatile Singleton mInstance = new Singleton();
    }

    public static Singleton getInstance() {
        return SingletonHolder.mInstance;
    }
}
```
###### 4. 容器管理

```
/**
 * 单例  容器管理
 *
 * @author 512573717@qq.com
 * @created 2018/7/2 下午1:59.
 */
public class Singleton {

    private static Map<String, Object> mSingleMap = new HashMap<>();

    private Singleton(){
    }

    static {
        mSingleMap.put("service", new Singleton());
    }

    public static Object getServiceForName(String name) {
        return mSingleMap.get(name);
    }
}
```
###### 5. 其他体现形式

```
/**
 * 单例 其他体现形式
 *
 @author 512573717@qq.com
 * @created 2018/7/2 下午1:59.
 */
public class Singleton {

    private static Singleton mInstance;

    private Singleton() {
    }

    static {
        mInstance = new Singleton();
    }

    public static Object getInstance() {
        return mInstance;
    }
}
```